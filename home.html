<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sulagna Day</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { margin:0; overflow:hidden; }
    #intro-text {
      position: absolute;
      top: 70vh;
      left: 0;
      width: 100vw;
      text-align: center;
      font-size: 2.3em;
      color: #e75480;
      font-weight: bold;
      opacity: 0;
      letter-spacing: 2px;
      text-shadow: 0 8px 30px #fff7, 0 1px 1px #5552;
    }

    #intro-text button {
      display: block;
      margin: 1em auto 0;
      padding: 0.6em 1.5em;
      font-size: 1em;
      background-color: #e75480;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="heart-canvas"></canvas>
  <div id="intro-text">
    A Special Day for Someone Special...
    <button onclick="startExperience()">Start with Music ðŸŽµ</button>
  </div>

  <script>
    const canvas = document.getElementById('heart-canvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    const particles = [];
    const numParticles = 350;
    let centerX, centerY, scale;
    function calcHeartPoint(t, fluct = 0) {
      let r = 16 * Math.pow(Math.sin(t), 3);
      let s = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
      r += fluct;
      s += fluct / 1.3;
      return [r, s];
    }
    function updateHeartParams() {
      centerX = canvas.width / 2;
      centerY = canvas.height / 2 - 40;
      scale = Math.min(canvas.width, canvas.height) / 24;
    }
    updateHeartParams();
    window.addEventListener("resize", updateHeartParams);

    for (let i = 0; i < numParticles; i++) {
      const theta = Math.random() * 2 * Math.PI;
      const radius = Math.sqrt(Math.random()) * 190 + 40;
      const x = centerX + Math.cos(theta) * radius;
      const y = centerY + Math.sin(theta) * radius;
      const t = (2 * Math.PI) * (i / numParticles);
      particles.push({
        x, y,
        tx: 0, ty: 0,
        t: t,
        color: (Math.random() < 0.9) ? '#e75480' : '#fdcae1',
        size: Math.random() < 0.85 ? 3 : 6
      });
    }

    let animTime = 0;
    let forming = true, beating = false;
    function animateHeart() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      animTime += 0.022;
      particles.forEach((p, i) => {
        let fluct = forming ? (1 - Math.exp(-animTime)) * 40 * (Math.sin(i + animTime * 3)) / 12 : 0;
        let [hx, hy] = calcHeartPoint(p.t, fluct);
        let targetX = centerX + hx * scale;
        let targetY = centerY - hy * scale;
        if (beating) {
          const beat = 1 + 0.08 * Math.sin(animTime * 7);
          targetX = centerX + hx * scale * beat;
          targetY = centerY - hy * scale * beat;
        }
        p.x += (targetX - p.x) * 0.09;
        p.y += (targetY - p.y) * 0.09;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.globalAlpha = 0.9;
        ctx.fill();
      });
      ctx.globalAlpha = 1.0;

      if (forming && animTime > 2.7) {
        document.getElementById("intro-text").style.opacity = Math.min(1, (animTime - 2.7) / 1.3);
      }
      if (forming && animTime > 4.5) {
        forming = false;
        beating = true;
        document.getElementById("intro-text").style.opacity = 1;
      }

      requestAnimationFrame(animateHeart);
    }
    animateHeart();

    function startExperience() {
      // Open music window
      if (!window.musicWindowOpened || window.musicWindowClosed) {
        window.open(
          'music.html',
          'musicPlayer',
          'width=1,height=1,left=-1000,top=-1000'
        );
        window.musicWindowOpened = true;
        window.musicWindowClosed = false;
      }

      // Redirect to wish.html after short delay (optional)
      setTimeout(() => {
        window.location.href = "wish.html";
      }, 800);
    }

    // OPTIONAL: Remove automatic redirect on load
    // window.addEventListener('load', openMusicWindow);
  </script>
</body>
</html>
